package de.pdark.tutorial.hotfix.base;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.List;

import org.hibernate.SessionFactory;
import org.springframework.beans.factory.annotation.Autowired;
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...
//import ...

public class Order {
    /*
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    @Autowired
    private ...;
    */
    @Autowired
    private String dburl;
    @Autowired
    private String dbuser;
    @Autowired
    private String dbpassword;
    @Autowired
    private SessionFactory sessionFactory;
    
    // ... lots of code omitted ...
    
    public List<OrderItem> collectOrder(User user, long orderId) throws SQLException {
        Connection conn = DriverManager.getConnection(dburl, dbuser, dbpassword);
        PreparedStatement stmt = conn.prepareStatement("select * from orders where orderId = ?");
        stmt.setLong(1, orderId);
        ResultSet rs = stmt.executeQuery();
        List<OrderItem> orderItems = new ArrayList<>();
        while (rs.next()) {
            String name = rs.getString(1);
            PreparedStatement stmt2 = conn.prepareStatement("select * from articles");
            ResultSet rs2 = stmt2.executeQuery();
            boolean found = false;
            double amount = 0;
            while (rs2.next()) {
                if (rs2.getString(2).equals(name)) {
                    amount = rs.getDouble(3);
                    found = true;
                }
            }
            if (found) { orderItems.add(new OrderItem(name, (long)(amount*100))); }
            rs2.close();
            stmt2.close();
        }
        rs.close();
        stmt.close();
        conn.close();
        return orderItems;
    }
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































    public void foo() {        
        //... code deleted ...
        sessionFactory.getCurrentSession();
        //... code deleted ...
        
        
    }

}
